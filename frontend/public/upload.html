<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galleriya - ì—…ë¡œë“œ</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="background-animation"></div>

    <div class="hero-spacer"></div>

    <main>
        <section class="upload-section">
            <div class="glass-card upload-card">
                <h2>ì‚¬ì§„ ì—…ë¡œë“œ</h2>
                <p>ìµëª…ìœ¼ë¡œ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”. 24ì‹œê°„ í›„ ìë™ìœ¼ë¡œ ì‚¬ë¼ì§‘ë‹ˆë‹¤.</p>
                <form id="uploadForm">
                    <div class="preview-container" id="previewContainer">
                        <div class="placeholder-icon">ğŸ“·</div>
                        <img id="preview-img" src="#" alt="Image Preview" style="display: none;">
                    </div>
                    <label for="fileInput" class="custom-file-upload">
                        ì‚¬ì§„ ì„ íƒí•˜ê¸°
                    </label>
                    <input type="file" id="fileInput" accept="image/*" required>
                    <span id="fileName">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</span>
                    <button type="submit" class="upload-btn">ì—…ë¡œë“œ</button>
                </form>
            </div>
        </section>
    </main>

    <footer id="footer">
        <p>ë¬¸ì˜: contact@galleriya.com</p>
        <p>&copy; 2024 Galleriya. ìµëª…. í•œì‹œì . ì•„ë¦„ë‹¤ì›€.</p>
    </footer>

    <script src="js/upload.js"></script>
    <script src="js/header.js"></script>
    <script>
        const fileInput = document.getElementById('fileInput');
        const fileNameDisplay = document.getElementById('fileName');
        const previewImg = document.getElementById('preview-img');
        const placeholderIcon = document.querySelector('.placeholder-icon');

        fileInput.addEventListener('change', function (e) {
            if (this.files && this.files.length > 0) {
                const file = this.files[0];
                fileNameDisplay.textContent = file.name;

                // Preview with resizing
                const reader = new FileReader();
                reader.onload = function (event) {
                    const img = new Image();
                    img.onload = function () {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // Calculate new dimensions (max 500px width/height)
                        const MAX_SIZE = 500;
                        let width = img.width;
                        let height = img.height;

                        if (width > height) {
                            if (width > MAX_SIZE) {
                                height *= MAX_SIZE / width;
                                width = MAX_SIZE;
                            }
                        } else {
                            if (height > MAX_SIZE) {
                                width *= MAX_SIZE / height;
                                height = MAX_SIZE;
                            }
                        }

                        canvas.width = width;
                        canvas.height = height;
                        ctx.drawImage(img, 0, 0, width, height);

                        const dataUrl = canvas.toDataURL(file.type);
                        previewImg.src = dataUrl;
                        previewImg.style.display = 'block';
                        // Ensure full image is visible
                        previewImg.style.objectFit = 'contain';
                        placeholderIcon.style.display = 'none';
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            } else {
                fileNameDisplay.textContent = 'ì„ íƒëœ íŒŒì¼ ì—†ìŒ';
                previewImg.style.display = 'none';
                placeholderIcon.style.display = 'block';
            }
        });

        // Upload functionality
        const uploadBtn = document.querySelector('.upload-btn');
        uploadBtn.addEventListener('click', async (e) => {
            e.preventDefault();

            if (!fileInput.files || fileInput.files.length === 0) {
                alert('íŒŒì¼ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            try {
                uploadBtn.disabled = true;
                uploadBtn.textContent = 'ì—…ë¡œë“œ ì¤‘...';

                const API_URL = 'http://127.0.0.1:5000/api';
                const response = await fetch(`${API_URL}/upload`, {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    alert('ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    window.location.href = 'index.html';
                } else {
                    const errorData = await response.json();
                    alert(`ì—…ë¡œë“œ ì‹¤íŒ¨: ${errorData.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
            } catch (error) {
                console.error('Error uploading file:', error);
                alert('ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                uploadBtn.disabled = false;
                uploadBtn.textContent = 'ì—…ë¡œë“œ';
            }
        });
    </script>
</body>

</html>